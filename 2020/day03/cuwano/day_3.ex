defmodule Day3 do
  def sample_input() do
    """
    ..##.......
    #...#...#..
    .#....#..#.
    ..#.#...#.#
    .#...##..#.
    ..#.##.....
    .#.#.#....#
    .#........#
    #.##...#...
    #...##....#
    .#..#...#.#
    """
  end

  def input() do
    """
    ...........#..............##...
    ...#....................#......
    .....####...........#.#..#.#...
    ....##.#.......................
    .......#.##......#.###.........
    .#.....#.......##.......#.....#
    ...........##....##.#....#.....
    ......#.........#....#.........
    ..###....#.........#....#.#....
    ....#....#.#..#..#.........#.#.
    ..........................#...#
    .##...........#...#.#.......#..
    #....##...#.#....#.............
    ....#..##......##..#.#....#....
    #..........#.............#..#.#
    ...#.####.....#..#.#.#..#...#..
    ..........#......#........#..#.
    ............#.....#..#..#....#.
    .................#...#.........
    ..#...#...................#....
    ..............##...#...........
    ..........................#..#.
    #...#...#............#...#.....
    .................#..##.......#.
    ............#....#.............
    .#......#.#...#....#...#.......
    .....#.....##..##.....#.......#
    .#..#..##...............#..#...
    #...#...##............#........
    .......#....#.......#..........
    ...............................
    #................#...#.........
    ...#...#..#..#.............##.#
    ......#........#..............#
    ...#.....##.#...#...#..........
    .........#..#........##.#...##.
    #.........##..#.......#........
    ........##.#.#.................
    .#....#............###....#....
    ...#.##....#.....##..#..#....#.
    ....#..#........##..#...#..##..
    ..........#............#.......
    .........#........##....#..##..
    #....#.........#.#.......#..#..
    ...#....#......##.#............
    ........#..#...............#...
    ..............#.....#........#.
    ......#..#.#........#..#..#.##.
    ..#........###....#.#..........
    ...#..#...#.#....##..#........#
    ........#..#..............#....
    #.####.................#....##.
    .#................#............
    ....#....#....#................
    #......#........##....#...#....
    ......#..##..#..###...#.#.#....
    .#..........##.................
    ...#...#....#...#.....#.....#..
    ............#......##.........#
    ..............##...............
    ##....#....#...#...#....#..###.
    ...................#.......##..
    #.....##........#....#.........
    ...#.......#...........#.......
    ...............##..............
    ##.......#......#.....#........
    #....#..#..##..#.......#..#..#.
    .....#.............#.......#...
    ......#..#........#.......#.#..
    ..#...#...........#.##.........
    ..#................####.#..#...
    ......##....#.........#........
    ..#..#.......#...##....#......#
    #.#..........#..............#.#
    .#.#..............#.##...#.....
    ................#.....#.#......
    ##.........#.........#.....#...
    ....#.#.....................#..
    ..#..#..#........#.......#.....
    .....#..#.#....#....#.....#....
    ..####....#.#.........#........
    #..##...##..#.#............#..#
    .#........#..##.#.....#......##
    .##.##.....##....#.#...........
    ....#..#.#..##............#.#..
    ........#.#...#....#.........#.
    .....#.#.#.....#....#.....##...
    #...#..#....##..#..............
    ..#...#....#...##..#.......#...
    .#....##.......................
    .........#............##.#..#..
    ....#................#...#.#...
    ...................#..#...#....
    #..#...................#.......
    ..##..............#..........##
    ...#.##......#.............#...
    .........#.#.........#.........
    ...###......#.................#
    ..........#....##..............
    .##..#....#.........#.#........
    .........#.......#.......#.#...
    #........#............#......#.
    ....................#..........
    .......#...##..........#...#...
    ....#.#.......#.#...##..#.#....
    ...#..........#..............#.
    ........##..............#......
    ......#...##......#....##......
    ....#.....#.#.##..............#
    ...#...........#.#.............
    ...........#......#.#..........
    ...#.#......#......#...#...#...
    ..#.......................#....
    ...#...#..#..................#.
    ##.....#.....#..#..#.....#...#.
    .#..#.......##.#.#.............
    ......##.......##............#.
    .......#..#..#.......#....#.#..
    ......#.....##..##...#........#
    .....#........#.##..........#..
    #....##............#........#..
    .....#..#...#............#...#.
    ##.#....#........#.............
    .##...............##......#.#..
    ###..#..#.......#.#..........#.
    .....#...........#...##........
    ..#.#.#.........#.....#....#...
    .....#....##.......#..#.#......
    ......#.....#...#..#...##..#...
    .....#....#................#...
    ......#....#.#...##......##.#.#
    .....###.............#.........
    .................#......#####..
    .#.......#..........#.#....##..
    ..#..#.......#.....#..#......##
    ..........#.#.##.......##....#.
    ##...#...##.##......#..###.....
    ..#..#..#......#....#..........
    ..#...#....#......#....#....#.#
    .#...#........#.....#......#..#
    #.........#......#.##.##.......
    #.##..#.............#.....#....
    ....#.......#..#..##...##......
    ...#.............#.#......#....
    #.....#..........##...##.....#.
    ...............#........#....#.
    #.....#...#..#.............##..
    .#....##.#.......#.#..........#
    ....#....#.#.....#....#......#.
    ......#......#.................
    .#.#..#.#.#...#...#..#.##.#..##
    .............#.....#...........
    ............#...#..#..#.....#..
    .#..........#.......#....#.....
    ......#..###.#...#.............
    ......#..........#.............
    ....#.................#..#.#.#.
    ...##.##.#....##.##............
    ####......#........###......#..
    ..#.......#.#..#.##............
    .....#.....#.#.......#.....#...
    .....#..........#.#............
    #.....#.............#......##..
    ......##..........##....#......
    .#..............#..........#...
    ......#..#...#........#..#....#
    .#......#.......#..#...........
    ..#..#....#.#.......#....##..#.
    ........#.#................#...
    #.......#.##.#......#...#.....#
    ..#...#.#.....##...............
    ..........#.....##.............
    .......#............#........#.
    ...#............#......#......#
    .#..#.......#...#...#..#..#....
    #....#.#...#......#...#......#.
    .#.......#..#.#...........#....
    ...##.#...#.......#..........#.
    .....#..............#..#...#...
    ...........................#...
    .............#.....#...........
    ....#.#..#..#...#..#...........
    .....#.#.#..#.#....#.#.#.......
    .......#..............#.....##.
    ........#..#..#.#..#...#.#.....
    .....#.#...#.#.#.....#..#...#..
    .....#....#.......#......#.#...
    .#.#...........#........#......
    .##..##......#......#......#.#.
    .....#.###.#.......##.#..#.....
    #.......##..#.........#....#...
    .#.............#.........#.#.#.
    ..........#..#..#....#....#....
    #....#...........##..#.....#..#
    ......#....#...###..#...#......
    .....#....#........#....#..#...
    ...##..............#.##...#....
    .#............#........##......
    ..##........#.#...........#...#
    ..#.#...##...#..#..........##..
    .................#.......#.....
    ......#.....#............#.....
    .#.....#.........#.#..#.#......
    .............#.#.#..#.......#.#
    #......#.....#..##...#.......#.
    .......#.#..#...#.........#....
    ...#..##...#.........#.#....#..
    ........................#..#...
    ....##..##................#....
    .......#..#.......#........##..
    .....#....#.##....#............
    .#....#............#.....#...#.
    ..##.....#......#......#.#....#
    ...#...........#...##....#.....
    ......#.##.#..##...##.#.#..##..
    .......##....#......#....#.#...
    .....####..#............#..##..
    ......##..##..##.........#...#.
    .#.#...............#.........#.
    ......#......#...........#.....
    .....#.......##.....#..#.......
    .....##..#..#....#.#.......#...
    ...........###.###.##..#.#..#..
    .#...............##.........#..
    ......##..........#..#.....##.#
    .............#....#....#..##...
    .#..............#........#.....
    .#..#.........................#
    .##..............#..........#..
    ..#..#.#.#.#......#............
    ....#...#.#.#....#........#..#.
    .....#........#....#.....#.....
    .#...#.#......#..#........#.##.
    .......#.....#................#
    .#.#........................#..
    ............#..#.......#.......
    ....##.#........#...#.#.#.#.#..
    .....#.......##................
    ...##...#....#.....#.#.........
    #...#..............#.......#...
    ...#.#.#.#..##....##...........
    .....##...#....#.....#.........
    #......#.....#....#............
    ....#..###....#.##.......#...#.
    ..................##.#......#..
    .....##..............##.#....#.
    .........#...#........#..#....#
    .##..#.........#....#..##...#..
    #.#.##................#.##.....
    ..#.#....#.#.......#....#......
    ..#.#.##.#.......#.............
    ..#....#.#..##.#..........#.#..
    #.....#.....#.....#.........#..
    #.......##.....#....##.....#...
    ..#...#.........##.#..##.......
    ..#.#.........#.......#........
    #.....#.....##.#.#..#...#..#.##
    .........................#.##..
    ..#.#..#..#..#........#......#.
    ..#..............#.............
    .....#.......##.##.....#.......
    ....#...#...............#..#...
    ....#......#.#........##.#..#.#
    ....................#..#.......
    .....#.......#......#.##.......
    #.......##..........#.....#....
    .#.......#....#.#......#.......
    ......#...#...............#.##.
    ....##.#.....#.............#.##
    #..#................##...#.....
    ....###......#.#.........#..#..
    ...#...#......#...##....#...#.#
    ..#...#.#.##.#.................
    .....##......#..#.#....#.......
    ##.......#......#.#..#.#.......
    .#.#.#.........#...#.#..#......
    #...#.#........#....#.#.....#..
    ....#.......##....#......##....
    .....#..........#......#....#..
    #...#....#...#.....#.#.........
    ...#..##.....##....#.....#.#...
    ..................#.....##.....
    .....#............#............
    ...#.....#..#........#.#..##...
    .......#.#.....................
    ......#...#.......#..#...#..#..
    .#..#...#.....##.....#.#.#....#
    ....##...#.#............#..#..#
    ...........#............#..#...
    .......#.....#................#
    ..#......#.#.......#.#.........
    .....#..#.#.##.................
    .....#..#......................
    ...#....#...#..#.#..#....#.....
    .#............#.....#..........
    #.##..#..#.......#......#.....#
    .#.........#....#....#.........
    ...#.#.#........#.#....#...#...
    #........#..#..#..........#..#.
    .....#..#.....##......##..##.#.
    ..............#.......#..#..#..
    ....#........#.##.#...#........
    ..#.#..#....#........##.....##.
    ...##.....#...#.......#.#....#.
    #.....#..##.##.#...##.......#..
    .....#........#.#.#....#.......
    .#................#####..#.#...
    ..........##..#..###....#......
    .....#.......#..........#..#...
    ..#....#....................#..
    #.....#..#.....#...##.#.....#.#
    ...#..##............#.....#....
    ##.#..#.......##...............
    ........##...#.#.....#......#..
    ........#...#..................
    #......#................#.#....
    ...........#...#..#.........#..
    ...#.##..#.##..................
    .....#......###......#..#......
    ..#.#.....#...#..#.##........#.
    ....#..........#.#.....#.......
    ..#..........#..........#.#....
    ..#.##.......#......#..........
    """
  end

  def parse_input(input), do: String.split(input, "\n", trim: true)

  def calculate_colision(row, index) do
    row_length = String.length(row)
    selector = rem(index, row_length)

    case row |> String.graphemes() |> Enum.at(selector) do
      "." -> 0
      "#" -> 1
    end
  end

  def solve_1(input) do
    parsed_input = parse_input(input)

    parsed_input
    |> Enum.reduce({0, 0}, fn row, {index, result} ->
      new_result = calculate_colision(row, index) + result
      {index + 3, new_result}
    end)
    |> elem(1)
  end

  def solve_2(input) do
    parsed_input = parse_input(input)

    slope_info = [{1, 1}, {3, 1}, {5, 1}, {7, 1}, {1, 2}]

    Enum.map(slope_info, fn {right, down} ->
      parsed_input
      |> Enum.take_every(down)
      |> Enum.reduce({0, 0}, fn row, {index, result} ->
        new_result = calculate_colision(row, index) + result
        {index + right, new_result}
      end)
      |> elem(1)
    end)
    |> Enum.reduce(fn x, acc -> x * acc end)
  end
end
